#!/usr/bin/env bash
set -e

function printStatus {
    if [ $? -eq 0 ]; then
        echo -e "\nPOP POP POP POP POP POP POP"
    else
        echo -e "\nMAN DOWN"
    fi
}

trap printStatus EXIT

. $(dirname $0)/goenv

git pull
git checkout master

go install -v github.com/onsi/ginkgo/ginkgo

rm -f bin/gcf

if [[ $1 == '-s' ]]
then
  echo "Using $(which cf) as gcf"
  ln -s $(which cf) bin/gcf
else
  curl -L https://s3.amazonaws.com/go-cli/builds/cf-linux-amd64 > bin/gcf
  chmod +x bin/gcf
fi

export local_bin=$(cd $(dirname $0) && pwd)
PATH=$PATH:$local_bin GOPATH=$(godep path):$GOPATH ginkgo -r -slowSpecThreshold=120 ./gats
