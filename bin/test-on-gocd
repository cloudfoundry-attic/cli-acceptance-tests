#!/usr/bin/env bash

set -e

export CF_RAISE_ERROR_ON_WARNINGS=true

#export GOPATH=~/go

rm -rf $GOPATH/pkg/*

echo `ls $GOPATH`
echo $PWD
echo `ls $PWD`

bin/create-gats-config
export CONFIG=$PWD/config.json
cat $CONFIG

(trap "exit 0" EXIT && go get -d github.com/pivotal-cf-experimental/GATS/...)
echo `ls $GOPATH`
echo $PWD
echo `ls $PWD`
export GATSPATH=$GOPATH/src/github.com/pivotal-cf-experimental/GATS
echo $GATSPATH
echo `ls $GATSPATH`

curl https://s3.amazonaws.com/go-cli/builds/cf-linux-amd64 > $GATSPATH/cf
chmod u+x $GATSPATH/cf

export PATH=$GATSPATH:$PATH

cd $GATSPATH

git pull
git checkout master

local_gopath=$GATSPATH/Godeps/_workspace

mkdir -p $local_gopath/bin

export GOPATH=$local_gopath:$GOPATH
export PATH=$local_gopath/bin:$PATH

go install -v github.com/onsi/ginkgo/ginkgo
echo "CATS STRAPPED WITH GATS"
ginkgo.exe -r -slowSpecThreshold=120 ./gats